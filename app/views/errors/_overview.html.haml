.row
  - max_value = @chart_data.values.max
  = line_chart @chart_data , id: "chart", height: "200px", label: "Occurences", colors: ["black", "#000"], min: 0, max: max_value > 0 ? max_value : 10
.row
  .col-sm-10.col-md-12
    .panel.panel-default
      .panel-heading Details
      .panel-body
        %dl
          %dt Occured at
          %dd= @issue.created_at
          %dt First seen at
          %dd= @error.first_seen
          %dt Message
          %dd= @issue.message
          %dt Url
          %dd #{@issue.http_data(:url) || '<no information>'}
          %dt File
          %dd= @error.culprit
          %dt User Agent
          %dd= @issue.get_headers(:user_agent)
          %dt ID
          %dd= @issue.event_id
          %dt Level
          %dd= @error.level
          %dt Logger
          %dd= @error.platform
  - valid_stacktrace = @issue.get_platform_frames && @issue.get_platform_frames.present?
  - if valid_stacktrace
    .col-sm-10.col-md-12
      .panel.panel-default.exception
        .panel-heading Exception
        .panel-body.expand-box
          #frame.accordion
            - @issue.get_platform_frames.each_with_index do |frame, index|
              .accordion-group
                .accordion-heading.heading
                  %a.accordion-toggle.collapsed{ href: '#' }
                    %i.icon-fixed-width.fa.fa-plus{"data-parent" => "#frame", "data-toggle" => "collapse", :href => "#collapse#{index}"}
                    = frame.get_culprit_string(with_lineno: true)
                .accordion-body.collapse{:style => "height: 0px;", :id => "collapse#{index}"}
                  .accordion-inner.content
                    %pre
                      %code{ class: @error.platform }
                        = frame._data[:pre_context] ? simple_format(frame._data[:pre_context].join('')).html_safe : ''
                        = frame._data[:context_line] ? simple_format(frame._data[:context_line], class: 'error-line').html_safe : ''
                        = frame._data[:post_context] ? simple_format(frame._data[:post_context].join('')).html_safe : ''

          %p.read-more.text-center{style: "display:block"}
            %a.btn.btn-default{:href => "#"} View full backtrace
  - valid_stacktrace = @issue.breadcrumbs_stacktrace && @issue.breadcrumbs_stacktrace.present?
  - if valid_stacktrace
    .col-sm-10.col-md-12
      .panel.panel-default
        .panel-heading Breadcrumbs
        .panel-body{ class: "#{valid_stacktrace ? 'expand-box' : ''}" }
          #frame.accordion
            %pre
              %code
                %table.table
                  - @issue.breadcrumbs_stacktrace.each_with_index do |crumb, index|
                    %tr
                      %td.line{ class: crumb[:level].present? ? "#{crumb[:level]}" : "log"}= crumb[:category]
                      - data = crumb[:data]
                      - if data.blank?
                        %td= crumb[:message]
                      - else
                        %td #{data[:method]} #{data[:url]} [#{data[:status_code]}]
                      %td.timestamp= Time.at(crumb[:timestamp]).strftime("%H:%M:%S")
          %p.read-more.text-center{style: "display:#{valid_stacktrace ? 'block' : 'none'}"}
            %a.btn.btn-default{:href => "#"} View full backtrace

  .col-sm-10.col-md-12
    .panel.panel-default.broadcast{ :style => "display:#{ @error.website.users.empty? ? 'none' : 'block' }" }
      .panel-heading
        Broadcast
      .panel-body
        -if current_website.intercom_integration?
          #custom-bootstrap.navbar.navbar-default{:role => "navigation"}
            %ul.nav.navbar-nav.navbar-left#details-tabs.main-tabs
              %li.active
                %a{ "data-toggle" => "tab", :href => "#email" } E-mail
              %li
                %a{ "data-toggle" => "tab", :href => "#intercom" } Intercom
          .tab-content
            #email.tab-pane.fade.in.active
              = render partial: 'errors/notify_form'
            #intercom.tab-pane.fade
              - intercom_users = current_website.intercom_integration.driver.list_subscribers
              .subscribers
                - intercom_users.each do |subscriber|
                  -  if subscriber[:avatar]
                    = image_tag subscriber[:avatar]
                  - else
                    - gravatar = Digest::MD5.hexdigest(subscriber[:email]).downcase
                    = image_tag "http://gravatar.com/avatar/#{gravatar}.png?s=30"
                  - if intercom_users.size > 10
                    = " and #{intercom_users.size - 10} more"
                    - break
                - if intercom_users.size > 0
                  %h5.pull-right
                    This message will be sent to
                    = intercom_users.size.to_s + (intercom_users.size > 1 ? ' users' : ' user')
                  .notify
                    = form_for @error, url: notify_subscribers_error_path(current_website.intercom_integration, users: intercom_users, intercom: true), remote: true, html: { method: :post , class: ' broadcast-textarea'}, :data => {:confirm => 'Are you sure?'} do |f|
                      = text_area_tag 'message', '', placeholder: 'Write a message ...'
                      %button.btn.btn-primary{:type => 'submit'} Send
                - else
                  %p Sorry, we couldn't find any intercom users.
        -else
          = render partial: 'errors/notify_form'
